let detector,lastRunWorker,mps=0;Module.addOnPostRun(()=>{postMessage({msg:"bootedUp"})}),onmessage=function(t){lastRunWorker||(lastRunWorker=(new Date).getTime());let e=((new Date).getTime()-lastRunWorker)/1e3;lastRunWorker=(new Date).getTime(),mps=Math.round(1/e*100)/100;let a={};switch(a.mps=mps,a.contour=[],t.data.msg){case"init":detector=new documentExtractor(t.data.output,t.data.qualityThreshold,t.data.edgeOffset),a.text="Capturando...",a.msg="init";break;case"update":detector.setQualityThreshold(t.data.qualityThreshold),detector.setEdgeOffset(t.data.edgeOffset),console.log("DocumentExtractor update: qualityThreshold="+t.data.qualityThreshold+" edgeOffset="+t.data.edgeOffset),a.text="update...",a.msg="update";break;case"detect":a.image=t.data.image;try{let e=detector.detectCard(t.data.image,t.data.output,Math.floor(t.data.width),Math.floor(t.data.height),Math.floor(t.data.roiWidth),Math.floor(t.data.roiHeight));e.show&&(a.show=e.show),e.show&&(a.output=e.out),a.contour=e.cnt,a.msg="detected",a.text=a.mps,a.edges=e.edges}catch(t){console.log("Exception captured.",t),a.contour=[!1,!1,!1,!1]}}postMessage(a)};