if(!FPhi)var FPhi={};if(FPhi.SelphID||(FPhi.SelphID={}),void 0===FPhi.SelphID.Drawer){class Drawer{constructor(t,i,e){this.mode=t,this.preview=i,this.canvasSizeFactor=1,this.fontSizeFactor=1,this.documentRect=e,this.searchingTextMode=1,this.searchingTextModeTime=0,this.cameraCount=0}setCanvasSize(t,i){this.width=t,this.height=i,this.landscape=this.width>=this.height,this.statusHeight=50,this.documentPadding=30,this.buttonWidth=216,this.buttonHeight=55}fromScreenToCamera(t,i,e,h,s,a,r){var d=this.getCameraRect(t,i,e,h,s),n=r.x-d.x,c=r.y-d.y,l=r.width,o=r.height,g={x:n/d.width*i,y:c/d.height*e,width:l/d.width*i,height:o/d.height*e};return 1==a&&(g.x=i-g.x-g.width),g}getCameraRect(t,i,e,h,s,a){var r=this.scaleRect({width:i,height:e},{x:0,y:0,width:h,height:s});return r.visible=!0,"UCTutorial1"!=a&&"UCTutorial2"!=a&&"UCTutorial3"!=a&&"UCPreview"!=a&&"Error"!=a||(r.visible=!1),r}getDocRectScreenSpace(t,i,e,h){var s={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:i-2*this.documentPadding,height:e-this.statusHeight-2*this.documentPadding},a=this.scaleRect(this.documentRect,s,"inner");return this.cameraCount>1&&a.x+a.width>i-60&&a.y+a.height>e-60&&(s={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:i-60-this.documentPadding,height:e-this.statusHeight-2*this.documentPadding},a=this.scaleRect(this.documentRect,s,"inner")),h&&(a.x+=h,a.y+=h,a.width-=2*h,a.height-=2*h),a}getDocRect(t,i,e,h,s,a,r){var d=this.getDocRectScreenSpace(t,h,s,r);return this.fromScreenToCamera(t,i,e,h,s,a,d)}getResourceIdForState(t){return"UCWaitingFaceStart"==t?"StartExtractor":"UCCapture"==t||"UCCaptureCameraSwitch"==t||"UCCaptureTip"==t?"UCCapture":"UCCaptureStatus"==t?"UCCaptureStatus":"UCPreview"==t?"UCPreview":"UCFlip"==t?"UCFlip":"UCTutorial1"==t?"UCTutorial1":"UCTutorial2"==t?"UCTutorial2":"UCTutorial3"==t?"UCTutorial3":"UCErrors"==t?"Error":null}onMouseMove(t,i,e,h,s){t.style.cursor="button"==s||"buttonImage"==s?"pointer":"default"}draw(t,i,e,h,s,a,r,d,n){if(t.imageSmoothingEnabled=!0,"background"==s)this.drawBackground(t,i,e,h);else if("clearRect"==s)this.clearRect(t,i,e,h);else if("imageProc"==s)this.drawImageProc(t,i,e,h,a,r,d,n);else if("button"==s)this.drawButton(t,i,e,h);else if("buttonImage"==s)this.drawButtonImage(t,i,e,h,a,r,d,n);else if("image"==s)this.drawImage(t,i,e,h,a,r,d,n);else if("text"==s)this.drawText(t,i,e,h,a,r,d,n);else if("documentBorder"==s)this.drawDocumentBorder(t,i,e,h,a,r,d,n);else if("documentFlipper"==s)this.drawDocumentFlipper(t,i,e,h,a,r,d,n);else if("video"==s)void 0!=n.player&&t.drawImage(n.player,i.x,i.y,i.width,i.height);else if("animation"==s){var c=0;"UCLivenessMoveDetecting"==n.state&&(c=n.livenessMoveDirection),this.drawAnimation(t,i,e,h,a,r,d,n,c)}else"initialTip"==s&&this.drawInitialTip(t,i,e,h,a,r,d,n)}getLayout(t,i,e,h,s,a,r,d){if("document"==e)return{x:0,y:0,width:this.width,height:this.height};if("documentFlipper"==e)return{x:0,y:0,width:this.width,height:this.height};if("logo"==e){var n=this.rm.getSetupResourceId(i,e,this.landscape,"value"),c=this.rm.getImage(n),l=this.canvasSizeFactor*this.rm.getImageScale(),o=c.width*l,g=c.height*l;return{x:this.width/2-o/2,y:this.height-g-16,width:o,height:g}}if("background"==e)return{x:0,y:0,width:this.width,height:this.height};if("preview"==e||"previewFail"==e){let i,e=0;if("UCPreview"==d.state){this.landscape&&(e=64);let t={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding-e};i=this.scaleRect(this.documentRect,t,"inner")}else i=this.getDocRectScreenSpace(t,this.width,this.height,0);if("UCPreview"==d.state&&0==this.landscape){let t=this.height-50-100-39-12;i.y=50+t/2-i.height/2}return i}if("button_ok"==e){if(this.landscape)return{x:this.width/2+25,y:this.height-14-50,width:this.width/2-16-17,height:50};{let t={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding},i=this.scaleRect(this.documentRect,t,"inner"),e=this.height-50-100-39-12;i.y=50+e/2-i.height/2;let h=i.y+i.height+20;return{x:this.documentPadding,y:h,width:this.width-2*this.documentPadding,height:50}}}if("button_repeat"==e){if(this.landscape)return{x:16,y:this.height-14-50,width:this.width/2-16-17,height:50};{let t={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding},i=this.scaleRect(this.documentRect,t,"inner"),e=this.height-50-100-39-12;i.y=50+e/2-i.height/2;let h=i.y+i.height+20+50+12;return{x:this.documentPadding,y:h,width:this.width-2*this.documentPadding,height:50}}}if("text"==e){if(this.landscape){if("UCCaptureStatus"==d.state){var u=0,w={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding-u};return{x:(m=this.scaleRect(this.documentRect,w,"inner")).x+.4*m.width,y:m.y,width:.6*m.width,height:m.height}}return{x:0,y:28,width:this.width,height:50}}if("UCCapture"==d.state)return{x:0,y:(m=this.getDocRectScreenSpace(t,this.width,this.height,0)).y-20,width:this.width,height:m.y};if("UCCaptureStatus"==d.state){u=0,w={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding-u};return{x:(m=this.scaleRect(this.documentRect,w,"inner")).x+.4*m.width,y:m.y,width:.6*m.width,height:m.height}}return{x:0,y:28,width:this.width,height:50}}if("text_detail"==e){if(0==this.landscape)return{x:0,y:(m=this.getDocRectScreenSpace(t,this.width,this.height,0)).y+m.height+15+7,width:this.width,height:this.height}}else{if("previewImgOk"==e||"previewImgFail"==e){u=0;"UCPreview"==d.state&&this.landscape&&(u=64);w={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding-u};var m=this.scaleRect(this.documentRect,w,"inner");if("UCPreview"==d.state&&0==this.landscape){var p=this.height-50-100-39-12;m.y=50+p/2-m.height/2}n=this.rm.getSetupResourceId(i,e,this.landscape,"value"),c=this.rm.getImage(n),l=this.canvasSizeFactor*this.rm.getImageScale(),o=c.width*l,g=c.height*l;return{x:m.x+m.width/3.5-o/2,y:m.y+m.height/2-g/2,width:o,height:g}}if("tip"==e)return this.landscape?{x:0,y:30,width:this.width,height:200}:{x:0,y:50,width:this.width,height:200};if("tip_detail"==e)return this.landscape?{x:this.width/2,y:0,width:this.width/2,height:this.height}:{x:0,y:this.height/2-60,width:this.width,height:this.height-this.documentPadding-15-2*this.buttonHeight-(this.height/2-60-95)};if("background"==e)return{x:0,y:0,width:this.width,height:this.height};if("button_skip"==e){if(this.landscape){var v=this.buttonWidth;if(this.width<800)(x=(this.width-600)/200)<0&&(x=0),v-=v/2*(x=1-x);return{x:this.documentPadding,y:this.height-this.documentPadding-this.buttonHeight,width:v,height:this.buttonHeight}}{let t=this.width-2*this.documentPadding;return t>262&&(t=262),{x:this.width/2-t/2,y:this.height-this.documentPadding-this.buttonHeight,width:t,height:this.buttonHeight}}}if("button_next"==e){if(this.landscape){v=this.buttonWidth;if(this.width<800)(x=(this.width-600)/200)<0&&(x=0),v-=v/2*(x=1-x);return{x:this.width-this.documentPadding-v,y:this.height-this.documentPadding-this.buttonHeight,width:v,height:this.buttonHeight}}{let t=this.width-2*this.documentPadding;return t>262&&(t=262),{x:this.width/2-t/2,y:this.height-this.documentPadding-15-2*this.buttonHeight,width:t,height:this.buttonHeight}}}if("button_finish"==e){if(this.landscape){var x;v=this.buttonWidth;if(this.width<800)(x=(this.width-600)/200)<0&&(x=0),v-=v/2*(x=1-x);return{x:this.width-this.documentPadding-v,y:this.height-this.documentPadding-this.buttonHeight,width:v,height:this.buttonHeight}}{let t=this.width-2*this.documentPadding;return t>262&&(t=262),{x:this.width/2-t/2,y:this.height-this.documentPadding-15-2*this.buttonHeight,width:t,height:this.buttonHeight}}}if("button_back"==e){let t=this.width-2*this.documentPadding;return t>262&&(t=262),{x:5,y:0,width:t,height:this.buttonHeight}}if("video"==e){if(this.landscape){w={x:this.documentPadding,y:60,width:this.width/2-2*this.documentPadding,height:this.height-this.buttonHeight-2*this.documentPadding-50};return this.scaleRect(this.documentRect,w,"inner")}w={x:this.documentPadding,y:95,width:this.width-2*this.documentPadding,height:this.height/2-60};return this.scaleRect(this.documentRect,w,"inner")}if("initial_tip"==e){if("UCCaptureTip"==d.state)return{x:0,y:0,width:this.width,height:this.height}}else if("button_initial_tip"==e){if("UCCaptureTip"==d.state)return{x:this.width/2-113,y:this.height/2-79+92,width:226,height:45}}else{if("tip_video"==e)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("video_success"==e)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("extraction_video"==e)return{x:this.width/2-.1*this.width,y:.73*this.height,width:.2*this.width,height:.2*this.width};if("button_repeat"==e)return{x:.05*this.width,y:this.height-this.buttonHeight,width:.4*this.width,height:this.buttonHeight};if("button_finish"==e)return{x:.55*this.width,y:this.height-this.buttonHeight,width:.4*this.width,height:this.buttonHeight};if("button_exit"==e){n=this.rm.getSetupResourceId(i,e,this.landscape,"value"),c=this.rm.getImage(n),l=this.canvasSizeFactor*this.rm.getImageScale(),o=c.width*l,g=c.height*l;return{x:this.width-o-30,y:0,width:o+30,height:50}}if("button_info"==e){n=this.rm.getSetupResourceId(i,e,this.landscape,"value"),c=this.rm.getImage(n),l=this.canvasSizeFactor*this.rm.getImageScale(),o=c.width*l,g=c.height*l;return{x:0,y:0,width:o+30,height:50}}if("button_camera"==e){if(this.cameraCount<2)return null;n=this.rm.getSetupResourceId(i,e,this.landscape,"value"),c=this.rm.getImage(n),l=this.canvasSizeFactor*this.rm.getImageScale(),o=c.width*l,g=c.height*l;return{x:this.width-o-16,y:this.height-g-12,width:o+16,height:g+12}}if("warning"==e)return{x:0,y:.91*this.height,width:this.width,height:.1*this.height};if("warningTooFar"==e)return{x:0,y:.89*this.height,width:this.width,height:.1*this.height};if("camera"==h)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("results"==h)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("liveness_move_text"==e)return"UCLivenessMoveStabilizing"==d.state||"UCLivenessMoveStabilized"==d.state||"UCLivenessMoveDetecting"==d.state?{x:0,y:.89*this.height,width:this.width,height:.1*this.height}:null;if("liveness_move_tip_text"==e)return 800==this.width?null:{x:this.circleX-this.circleRadius,y:this.circleY-.39*this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("liveness_move_tip_text_challenge"==e)return 800!=this.width?null:{x:this.circleX-this.circleRadius,y:this.circleY-.39*this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("livenessInfo_text"==e)return{x:0,y:.89*this.height,width:this.width,height:.1*this.height};if("liveness_move_left"==e||"liveness_move_right"==e||"liveness_move_top"==e||"liveness_move_bottom"==e){if(-1==d.livenessMoveDirection)return null;if("UCLivenessMoveDetecting"==d.state&&a>=.25&&a<1.75){if(0==d.livenessMoveDirection&&"liveness_move_top"!=e)return null;if(2==d.livenessMoveDirection&&"liveness_move_bottom"!=e)return null;if(1==d.livenessMoveDirection&&"liveness_move_right"!=e)return null;if(3==d.livenessMoveDirection&&"liveness_move_left"!=e)return null;var y=!1;return this.rm.isAttributeAvailable(i,e,"fullscreen")&&"true"==this.rm.getSetupResourceId(i,e,this.landscape,"fullscreen")&&(y=!0),y?{x:0,y:0,width:this.width,height:this.height}:{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}return null}if("face_searcher"==e)return{x:0,y:0,width:this.width,height:this.height};if("livenessMoveGlasses"==e){if(2==d.livenessMoveFailReason)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else if("livenessMoveSunGlasses"==e){if(0==d.livenessMoveFailReason)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else if("livenessMoveInfo"==e){if(1==d.livenessMoveFailReason)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else{if("animation"==h){if(e!=d.state)return null;y=!1;return this.rm.isAttributeAvailable(i,e,"fullscreen")&&"true"==this.rm.getSetupResourceId(i,e,this.landscape,"fullscreen")&&(y=!0),y?{x:0,y:0,width:this.width,height:this.height}:{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}if(("liveness_ok"==e||"liveness_nok"==e)&&"UCLivenessMoveStabilizing"==d.state)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}}}return null}drawBackground(t,i,e,h){t.fillStyle=this.rm.getSetupColor(e,h,this.landscape,"color"),t.fillRect(i.x,i.y,i.width,i.height)}clearRect(t,i,e,h){t.clearRect(i.x,i.y,i.width,i.height)}drawPoint(t,i,e,h,s){t.fillStyle=s,t.beginPath(),t.arc(i,e,h,0,2*Math.PI),t.fill()}drawLine(t,i,e,h,s,a){t.lineWidth=1,t.strokeStyle=a,t.beginPath(),t.moveTo(i,e),t.lineTo(h,s),t.stroke()}drawButtonImage(t,i,e,h,s,a,r,d){var n=this.rm.getSetupResourceId(e,h,this.landscape,"value"),c=this.rm.getImage(n),l=this.canvasSizeFactor*this.rm.getImageScale(),o=c.width*l,g=c.height*l;t.drawImage(c,i.x+i.width/2-o/2,i.y+i.height/2-g/2,o,g)}drawButton(t,i,e,h){var s=this.rm.getSetupColor(e,h,this.landscape,"background");this.fillRoundedRect(t,i,6,1,1,s);var a=this.rm.getSetupColor(e,h,this.landscape,"decorator");this.drawRoundedRectProgressive(t,i,6,1,1,a,1);var r=this.rm.getSetupAlign(e,h,this.landscape,"align"),d=this.rm.getSetupNodeType(e,h,this.landscape),n=10*this.canvasSizeFactor;if("TEXT_ID"==d){var c=this.rm.getSetupTextId(e,h,this.landscape,"content"),l=this.rm.translate(c),o=this.rm.getSetupFloat(e,h,this.landscape,"font_size");o=Math.round(o*this.fontSizeFactor);var g=this.rm.getSetupResourceId(e,h,this.landscape,"font");t.font=o+"px '"+g+"'",t.textBaseline="alphabetic",t.fillStyle=this.rm.getSetupColor(e,h,this.landscape,"foreground");var u=t.measureText(l);"LEFT"==r?t.fillText(l,i.x+n,i.y+i.height/2+o/2):"RIGHT"==r?t.fillText(l,i.x+i.width-u.width-n,i.y+i.height/2+o/2):t.fillText(l,i.x+i.width/2-u.width/2,i.y+i.height/2+o/2)}else{c=this.rm.getSetupResourceId(e,h,this.landscape,"content");var w=this.rm.getImage(c),m=this.canvasSizeFactor*this.rm.getImageScale();"LEFT"==r?t.drawImage(w,i.x+n,i.y+i.height/2-w.height*m/2,w.width*m,w.height*m):"RIGHT"==r?t.drawImage(w,i.x+i.width-w.width*m-n,i.y+i.height/2-w.height*m/2,w.width*m,w.height*m):t.drawImage(w,i.x+i.width/2-w.width*m/2,i.y+i.height/2-w.height*m/2,w.width*m,w.height*m)}}drawImageProc(t,i,e,h,s,a,r,d){if(void 0!=d.previewImage){var n=d.previewImage,c=this.canvasSizeFactor*this.rm.getImageScale(),l={x:0,y:0,width:n.width*c,height:n.height*c},o=this.scaleRect(l,i,"inner");t.drawImage(n,o.x,o.y,o.width,o.height)}this.rm.isAttributeAvailable(e,h,this.landscape,"overlay")&&(t.fillStyle=this.rm.getSetupColor(e,h,this.landscape,"overlay"),t.fillRect(i.x,i.y,i.width,i.height))}drawImage(t,i,e,h,s,a,r,d){var n=this.rm.getSetupResourceId(e,h,this.landscape,"value"),c=this.rm.getImage(n),l=!1;this.rm.isAttributeAvailable(e,h,this.landscape,"scale")&&("CONTAINER"==this.rm.getSetupResourceId(e,h,this.landscape,"scale")&&(l=!0));if(l)t.drawImage(c,i.x,i.y,i.width,i.height);else{var o=this.canvasSizeFactor*this.rm.getImageScale(),g=c.width*o,u=c.height*o;t.drawImage(c,i.x+i.width/2-g/2,i.y+i.height/2-u/2,g,u)}}drawImageWithClippingCircle(t,i,e,h,s,a){t.save(),t.beginPath(),t.arc(h,s,a,0,2*Math.PI,!1),t.clip(),t.drawImage(e,i.x,i.y,i.width,i.height),t.restore()}cacheAnimation(t,i){for(var e=this.rm.getSetupResourceId(t,i,this.landscape,"name"),h=this.rm.getSetupResourceId(t,i,this.landscape,"ext"),s=parseInt(this.rm.getSetupResourceId(t,i,this.landscape,"start")),a=parseInt(this.rm.getSetupResourceId(t,i,this.landscape,"end")),r=s;r<=a;r++){var d=e+("0"+r).slice(-2)+"."+h;this.rm.getImage(d)}}drawAnimation(t,i,e,h,s,a,r,d,n){var c=.1;this.rm.isAttributeAvailable(e,h,"rate")&&(c=1/parseFloat(this.rm.getSetupResourceId(e,h,this.landscape,"rate")));var l="FINISH";this.rm.isAttributeAvailable(e,h,this.landscape,"animMode")&&(l=this.rm.getSetupResourceId(e,h,this.landscape,"animMode"));var o,g=this.rm.getSetupResourceId(e,h,this.landscape,"name"),u=this.rm.getSetupResourceId(e,h,this.landscape,"ext"),w=parseInt(this.rm.getSetupResourceId(e,h,this.landscape,"start")),m=parseInt(this.rm.getSetupResourceId(e,h,this.landscape,"end")),p=c*(m-w+1);if("FINISH"==l)(o=Math.floor(a/c+w))>m&&(o=m);else{var v=a%p/p;o=Math.floor((m-w)*v+w)}o<w&&(o=w),o>m&&(o=m);var x=g+("0"+o).slice(-2)+"."+u,y=this.rm.getImage(x);t.drawImage(y,i.x,i.y,i.width,i.height)}drawInitialTip(t,i,e,h,s,a,r,d){t.fillStyle="rgba(0,0,0,0.7)",t.fillRect(i.x,i.y,i.width,i.height);let n=this.rm.getSetupColor(e,h,this.landscape,"backgroundColor"),c={x:this.width/2-133,y:this.height/2-79,width:266,height:158};this.fillRoundedRect(t,c,6,1,1,n);var l=this.rm.getSetupResourceId(e,h,this.landscape,"image"),o=this.rm.getImage(l),g=this.canvasSizeFactor*this.rm.getImageScale(),u=o.width*g,w=o.height*g;t.drawImage(o,c.x+16,c.y+31,u,w);var m=this.rm.getSetupFloat(e,h,this.landscape,"font_size"),p=m+1;this.rm.isAttributeAvailable(e,h,this.landscape,"line_height")&&(p=this.rm.getSetupFloat(e,h,this.landscape,"line_height"));var v=this.rm.getSetupColor(e,h,this.landscape,"color"),x=this.rm.getSetupResourceId(e,h,this.landscape,"font"),y={x:c.x+50,y:c.y,width:c.width-35,height:92},f=this.rm.translate("capture_tip_text");this.drawStringMultiline(t,f,y,v,x,m,p,"LEFT","CENTER")}drawDocumentBorder(t,i,e,h,s,a,r,d){var n=this.rm.getSetupColor(e,h,this.landscape,"documentBorderColor"),c=this.rm.getSetupColor(e,h,this.landscape,"documentBorderDetectedColor"),l=0;"UCPreview"==d.state&&this.landscape&&(l=64),t.fillStyle=this.rm.getSetupColor(e,h,this.landscape,"statusColor"),t.fillRect(i.x,i.y,i.width,this.statusHeight);var o=this.getDocRectScreenSpace(t,i.width,i.height,0);if("UCPreview"==d.state){var g={x:i.x+this.documentPadding,y:i.y+this.statusHeight+this.documentPadding,width:i.width-2*this.documentPadding,height:i.height-this.statusHeight-2*this.documentPadding-l};if(o=this.scaleRect(this.documentRect,g,"inner"),0==this.landscape){var u=this.height-50-100-39-12;o.y=50+u/2-o.height/2}}t.save(),t.beginPath(),t.rect(i.x,i.y+this.statusHeight,i.width,i.height-this.statusHeight),t.rect(o.x,o.y,o.width,o.height),t.closePath(),t.clip("evenodd"),t.fillStyle=this.rm.getSetupColor(e,h,this.landscape,"backgroundColor"),t.fillRect(i.x,i.y+this.statusHeight,i.width,i.height-this.statusHeight),t.restore();var w=this.rm.getSetupFloat(e,h,this.landscape,"documentBorder");if(this.drawRoundedRectProgressive(t,o,6,w,2*w,n,1),"UCCapture"==d.state){var m=0;1==d.contour[0]&&m++,1==d.contour[1]&&m++,1==d.contour[2]&&m++,1==d.contour[3]&&m++,m>=2?s-this.searchingTextModeTime>.5&&(this.searchingTextMode=2,this.searchingTextModeTime=s):s-this.searchingTextModeTime>.5&&(this.searchingTextMode=1,this.searchingTextModeTime=s);var p,v=this.rm.getSetupFloat(e,h,this.landscape,"font_size"),x=this.rm.getSetupColor(e,h,this.landscape,"font_color"),y=this.rm.getSetupResourceId(e,h,this.landscape,"font");p=1==this.searchingTextMode?this.rm.translate("searching1_text"):this.rm.translate("searching2_text"),this.drawStringMultiline(t,p,o,x,y,v,"CENTER","CENTER")}t.lineWidth=this.rm.getSetupFloat(e,h,this.landscape,"documentBorder");var f=.15*o.width,R=.15*o.height;1==d.contour[0]&&(t.beginPath(),t.strokeStyle=1==d.contour[0]?c:n,t.moveTo(o.x+f,o.y+6),t.lineTo(o.x+o.width-f,o.y+6),t.stroke()),1==d.contour[1]&&(t.beginPath(),t.strokeStyle=1==d.contour[1]?c:n,t.moveTo(o.x+o.width-6,o.y+R),t.lineTo(o.x+o.width-6,o.y+o.height-R),t.stroke()),1==d.contour[2]&&(t.beginPath(),t.strokeStyle=1==d.contour[2]?c:n,t.moveTo(o.x+o.width-f,o.y+o.height-6),t.lineTo(o.x+f,o.y+o.height-6),t.stroke()),1==d.contour[3]&&(t.beginPath(),t.strokeStyle=1==d.contour[3]?c:n,t.moveTo(o.x+6,o.y+o.height-R),t.lineTo(o.x+6,o.y+R),t.stroke())}drawDocumentFlipper(t,i,e,h,s,a,r,d){var n=this.rm.getSetupColor(e,h,this.landscape,"documentBorderColor");this.rm.getSetupColor(e,h,this.landscape,"documentBorderDetectedColor");t.fillStyle=this.rm.getSetupColor(e,h,this.landscape,"statusColor"),t.fillRect(i.x,i.y,i.width,this.statusHeight);var c,l=this.getDocRectScreenSpace(t,this.width,this.height,0),o=l.x+l.width/2;a<.5?(c=1-(1-(c=1-a/.5))*(1-c)*(1-c),l.width=l.width*c,l.x=o-l.width/2):(c=1-(1-(c=(a-.5)/.5))*(1-c)*(1-c),l.width=l.width*c,l.x=o-l.width/2);if(t.save(),t.beginPath(),t.rect(i.x,i.y+this.statusHeight,i.width,i.height-this.statusHeight),t.rect(l.x,l.y,l.width,l.height),t.closePath(),t.clip("evenodd"),t.fillStyle=this.rm.getSetupColor(e,h,this.landscape,"backgroundColor"),t.fillRect(i.x,i.y+this.statusHeight,i.width,i.height-this.statusHeight),t.restore(),t.lineWidth=this.rm.getSetupFloat(e,h,this.landscape,"documentBorder"),t.strokeStyle=n,t.strokeRect(l.x,l.y,l.width,l.height),a<.5){var g=d.previewImage;t.drawImage(g,l.x,l.y,l.width,l.height)}}drawText(t,i,e,h,s,a,r,d){var n=this.rm.getSetupFloat(e,h,this.landscape,"font_size"),c=n+1;this.rm.isAttributeAvailable(e,h,this.landscape,"line_height")&&(c=this.rm.getSetupFloat(e,h,this.landscape,"line_height"));var l=this.rm.getSetupColor(e,h,this.landscape,"color"),o=this.rm.getSetupResourceId(e,h,this.landscape,"font"),g="CENTER";this.rm.isAttributeAvailable(e,h,this.landscape,"align")&&(g=this.rm.getSetupAlign(e,h,this.landscape,"align"));var u="TOP";this.rm.isAttributeAvailable(e,h,this.landscape,"valign")&&(u=this.rm.getSetupAlign(e,h,this.landscape,"valign")),s<.1&&(l="#00000000");var w="";if("text"==h)"UCCapture"==e?w=d.status==FPhi.SelphID.Mode.Front?this.rm.translate("capture_front_text"):this.rm.translate("capture_back_text"):"UCCaptureStatus"==e?w=d.status==FPhi.SelphID.Mode.Front?"Warning"==r?this.rm.translate("capture_status_front_fail"):this.rm.translate("capture_status_front_ok"):"Warning"==r?this.rm.translate("capture_status_back_fail"):this.rm.translate("capture_status_back_ok"):"UCPreview"==e?w=d.status==FPhi.SelphID.Mode.Front?this.rm.translate("preview_front_text"):this.rm.translate("preview_back_text"):"UCFlip"==e&&(w=this.rm.translate("flip_document"));else if("text_detail"==h)w=this.rm.translate("capture_detail_text");else if("tip"==h){if("UCTutorial1"==e?w=this.rm.translate("tutorial1_tip"):"UCTutorial2"==e?w=this.rm.translate("tutorial2_tip"):"UCTutorial3"==e&&(w=this.rm.translate("tutorial3_tip")),this.landscape&&this.width<800){var m=(this.width-600)/200;m<0&&(m=0),n-=n/2*(m=1-m)}}else"tip_detail"==h&&("UCTutorial1"==e?w=this.rm.translate("tutorial1_tip_detail"):"UCTutorial2"==e?w=this.rm.translate("tutorial2_tip_detail"):"UCTutorial3"==e&&(w=this.rm.translate("tutorial3_tip_detail")));this.drawStringMultiline(t,w,i,l,o,n,c,g,u)}drawStringMultiline(t,i,e,h,s,a,r,d,n){var c=i.split("\n");t.imageSmoothingEnabled=!1,a=Math.round(a*this.fontSizeFactor),t.font=a+"px '"+s+"'",t.fillStyle=h,t.textBaseline="middle";var l=e.y;if("CENTER"==n){var o=c.length*r;l=e.y+e.height/2-o/2+a/2}else if("BOTTOM"==n){o=c.length*r;l=e.y+e.height-o}for(var g=0;g<c.length;g++){var u=t.measureText(c[g]),w=e.width/2-u.width/2;"LEFT"==d?w=0:"RIGHT"==d&&(w=e.width-u.width),t.fillText(c[g],e.x+w,l+g*r)}}scaleRect(t,i,e){var h=i.x+i.width/2,s=i.y+i.height/2,a=i.width/t.width,r=i.height/t.height,d=t.width*a,n=t.height*a;return void 0==e?n<i.height&&(d=t.width*r,n=t.height*r):n>=i.height&&(d=t.width*r,n=t.height*r),{x:h-d/2,y:s-n/2,width:d,height:n}}getRoundedRectPerimeter(t,i,e){return 2*Math.PI*e+2*(t-2*e)+2*(i-2*e)}rotatePoint(t,i){return{x:t*Math.cos(i),y:t*Math.sin(i)}}drawRoundedRectProgressive(t,i,e,h,s,a,r){var d=this.getRoundedRectPerimeter(i.width,i.height,e)*r,n=0;if(t.lineWidth=h,t.strokeStyle=a,t.fillStyle=a,t.beginPath(),t.moveTo(i.x,i.y+i.height/2),(d-=n=(i.height-2*e)/2)<0){var c=(d+n)/n,l=i.x,o=i.y+i.height/2-n*c;return t.lineTo(l,o),void t.stroke()}if(t.lineTo(i.x,i.y+e),(d-=n=Math.PI/2*e)<0){c=(d+n)/n,l=i.x+e,o=i.y+e;return t.arc(l,o,e,Math.PI,Math.PI+Math.PI/2*c),t.stroke(),l+=(g=this.rotatePoint(e,Math.PI+Math.PI/2*c)).x,void(o+=g.y)}if(t.arc(i.x+e,i.y+e,e,Math.PI,Math.PI+Math.PI/2),(d-=n=i.width-2*e)<0){c=(d+n)/n,l=i.x+e+n*c,o=i.y;return t.lineTo(l,o),void t.stroke()}if(t.lineTo(i.x+i.width-e,i.y),(d-=n=Math.PI/2*e)<0){c=(d+n)/n,l=i.x+i.width-e,o=i.y+e;return t.arc(l,o,e,Math.PI+Math.PI/2,Math.PI+Math.PI/2+Math.PI/2*c),t.stroke(),l+=(g=this.rotatePoint(e,Math.PI+Math.PI/2+Math.PI/2*c)).x,void(o+=g.y)}if(t.arc(i.x+i.width-e,i.y+e,e,Math.PI+Math.PI/2,0),(d-=n=i.height-2*e)<0){c=(d+n)/n,l=i.x+i.width,o=i.y+e+n*c;return t.lineTo(l,o),void t.stroke()}if(t.lineTo(i.x+i.width,i.y+i.height-e),(d-=n=Math.PI/2*e)<0){c=(d+n)/n,l=i.x+i.width-e,o=i.y+i.height-e;return t.arc(l,o,e,0,Math.PI/2*c),t.stroke(),l+=(g=this.rotatePoint(e,Math.PI/2*c)).x,void(o+=g.y)}if(t.arc(i.x+i.width-e,i.y+i.height-e,e,0,Math.PI/2),(d-=n=i.width-2*e)<0){c=(d+n)/n,l=i.x+i.width-e-n*c,o=i.y+i.height;return t.lineTo(l,o),void t.stroke()}if(t.lineTo(i.x+e,i.y+i.height),(d-=n=Math.PI/2*e)<0){var g;c=(d+n)/n,l=i.x+e,o=i.y+i.height-e;return t.arc(l,o,e,Math.PI/2,Math.PI/2+Math.PI/2*c),t.stroke(),l+=(g=this.rotatePoint(e,Math.PI/2+Math.PI/2*c)).x,void(o+=g.y)}if(t.arc(i.x+e,i.y+i.height-e,e,Math.PI/2,Math.PI),(d-=n=(i.height-2*e)/2)<0){c=(d+n)/n,l=i.x,o=i.y+i.height-e-n*c;return t.lineTo(l,o),void t.stroke()}l=i.x,o=i.y+i.height/2;t.lineTo(l,o),t.stroke()}fillRoundedRect(t,i,e,h,s,a){t.lineWidth=h,t.strokeStyle=a,t.fillStyle=a,t.beginPath(),t.moveTo(i.x,i.y+i.height/2),t.lineTo(i.x,i.y+e),t.arc(i.x+e,i.y+e,e,Math.PI,Math.PI+Math.PI/2),t.lineTo(i.x+i.width-e,i.y),t.arc(i.x+i.width-e,i.y+e,e,Math.PI+Math.PI/2,0),t.lineTo(i.x+i.width,i.y+i.height-e),t.arc(i.x+i.width-e,i.y+i.height-e,e,0,Math.PI/2),t.lineTo(i.x+e,i.y+i.height),t.arc(i.x+e,i.y+i.height-e,e,Math.PI/2,Math.PI);var r=i.x,d=i.y+i.height/2;t.lineTo(r,d),t.fill()}}FPhi.SelphID.Drawer=Drawer}